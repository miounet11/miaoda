<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiaoDa Chat Debug</title>
    <script src="http://localhost:5173/@vite/client" type="module"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 20px;
            background: #0f0f0f;
            color: #fff;
        }
        .debug-info {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
        .warning { color: #ffd43b; }
        .info { color: #339af0; }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ” MiaoDa Chat è°ƒè¯•æ£€æŸ¥</h1>
    
    <div class="debug-info">
        <h3>ğŸ“± åº”ç”¨çŠ¶æ€æ£€æŸ¥</h3>
        <div id="app-status">æ£€æŸ¥ä¸­...</div>
    </div>
    
    <div class="debug-info">
        <h3>ğŸ”— ç½‘ç»œè¿æ¥</h3>
        <div id="network-status">æ£€æŸ¥ä¸­...</div>
    </div>
    
    <div class="debug-info">
        <h3>ğŸ“‹ æ§åˆ¶å°æ—¥å¿—</h3>
        <pre id="console-logs">ç­‰å¾…æ—¥å¿—...</pre>
    </div>
    
    <div class="debug-info">
        <h3>ğŸš€ å¿«é€Ÿä¿®å¤</h3>
        <button onclick="disableMultiWindow()" style="background: #ff6b6b; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px;">
            ğŸ”§ ç¦ç”¨å¤šçª—å£æ¨¡å¼
        </button>
        <button onclick="testSingleWindow()" style="background: #51cf66; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px;">
            ğŸ  æµ‹è¯•å•çª—å£æ¨¡å¼
        </button>
        <button onclick="checkLocalStorage()" style="background: #339af0; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px;">
            ğŸ’¾ æ£€æŸ¥æœ¬åœ°å­˜å‚¨
        </button>
    </div>

    <script>
        let logs = [];
        
        // æ‹¦æˆªæ§åˆ¶å°æ—¥å¿—
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = (...args) => {
            logs.push(`[LOG] ${args.join(' ')}`);
            updateLogs();
            originalLog(...args);
        };
        
        console.error = (...args) => {
            logs.push(`[ERROR] ${args.join(' ')}`);
            updateLogs();
            originalError(...args);
        };
        
        console.warn = (...args) => {
            logs.push(`[WARN] ${args.join(' ')}`);
            updateLogs();
            originalWarn(...args);
        };
        
        function updateLogs() {
            const logsEl = document.getElementById('console-logs');
            logsEl.textContent = logs.slice(-20).join('\n');
            logsEl.scrollTop = logsEl.scrollHeight;
        }
        
        // æ£€æŸ¥åº”ç”¨çŠ¶æ€
        async function checkAppStatus() {
            const statusEl = document.getElementById('app-status');
            
            try {
                // æ£€æŸ¥ Vite å¼€å‘æœåŠ¡å™¨
                const response = await fetch('http://localhost:5173/');
                if (response.ok) {
                    statusEl.innerHTML = '<span class="success">âœ… Vite æœåŠ¡å™¨è¿è¡Œæ­£å¸¸</span>';
                } else {
                    statusEl.innerHTML = '<span class="error">âŒ Vite æœåŠ¡å™¨å“åº”å¼‚å¸¸</span>';
                }
            } catch (error) {
                statusEl.innerHTML = '<span class="error">âŒ æ— æ³•è¿æ¥åˆ° Vite æœåŠ¡å™¨</span>';
                console.error('Vite server check failed:', error);
            }
        }
        
        // æ£€æŸ¥ç½‘ç»œçŠ¶æ€
        function checkNetworkStatus() {
            const networkEl = document.getElementById('network-status');
            
            if (navigator.onLine) {
                networkEl.innerHTML = '<span class="success">âœ… ç½‘ç»œè¿æ¥æ­£å¸¸</span>';
            } else {
                networkEl.innerHTML = '<span class="error">âŒ ç½‘ç»œè¿æ¥ä¸­æ–­</span>';
            }
            
            // æ£€æŸ¥ localhost è¿æ¥
            fetch('http://localhost:5173/src/renderer/src/main.ts')
                .then(response => {
                    if (response.ok) {
                        networkEl.innerHTML += '<br><span class="success">âœ… æœ¬åœ°æœåŠ¡è¿æ¥æ­£å¸¸</span>';
                    } else {
                        networkEl.innerHTML += '<br><span class="warning">âš ï¸ æœ¬åœ°æœåŠ¡è¿æ¥å¼‚å¸¸</span>';
                    }
                })
                .catch(error => {
                    networkEl.innerHTML += '<br><span class="error">âŒ æœ¬åœ°æœåŠ¡æ— æ³•è®¿é—®</span>';
                    console.error('Local service check failed:', error);
                });
        }
        
        // å¿«é€Ÿä¿®å¤å‡½æ•°
        function disableMultiWindow() {
            console.log('å°è¯•ç¦ç”¨å¤šçª—å£æ¨¡å¼...');
            localStorage.setItem('debug-single-window', 'true');
            alert('å·²è®¾ç½®å•çª—å£æ¨¡å¼æ ‡è®°ï¼Œè¯·é‡å¯åº”ç”¨');
        }
        
        function testSingleWindow() {
            console.log('æµ‹è¯•å•çª—å£æ¨¡å¼...');
            window.location.href = 'http://localhost:5173/#/';
        }
        
        function checkLocalStorage() {
            console.log('æ£€æŸ¥æœ¬åœ°å­˜å‚¨...');
            const storage = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                storage[key] = localStorage.getItem(key);
            }
            console.log('LocalStorage å†…å®¹:', storage);
            
            // æ¸…ç†å¯èƒ½æœ‰é—®é¢˜çš„å­˜å‚¨
            const problematicKeys = ['windowManager', 'activeWindow', 'tabs'];
            problematicKeys.forEach(key => {
                if (localStorage.getItem(key)) {
                    console.log(`æ¸…ç†å­˜å‚¨é¡¹: ${key}`);
                    localStorage.removeItem(key);
                }
            });
        }
        
        // å¯åŠ¨æ£€æŸ¥
        checkAppStatus();
        checkNetworkStatus();
        
        // å®šæœŸæ£€æŸ¥
        setInterval(() => {
            checkNetworkStatus();
        }, 5000);
        
        console.log('ğŸ” è°ƒè¯•é¡µé¢å·²åŠ è½½');
    </script>
</body>
</html>