<template>
  <div class="attachments-preview mb-4">
    <!-- Enhanced Drag and Drop Zone with Morphing Animation -->
    <div
      v-if="attachments.length === 0 && showDropZone"
      @drop="handleDrop"
      @dragover="handleDragOver"
      @dragenter="handleDragEnter"
      @dragleave="handleDragLeave"
      class="drag-drop-zone relative border-2 border-dashed rounded-xl p-6 text-center transition-all duration-300"
      :class="dragDropClasses"
    >
      <div
        class="drag-drop-content transition-all duration-300"
        :class="{ 'scale-110': isDragging }"
      >
        <div
          class="w-12 h-12 mx-auto mb-3 opacity-50 transition-all duration-300"
          :class="{ 'animate-bounce-gentle': isDragging }"
        >
          <ImageIcon
            :size="48"
            class="text-muted-foreground transition-colors duration-300"
            :class="{ 'text-primary': isDragging }"
          />
        </div>
        <p
          class="text-sm text-muted-foreground mb-2 transition-all duration-300"
          :class="{ 'text-primary font-medium': isDragging }"
        >
          拖拽图片到此处，或者
          <span
            class="text-primary hover:underline cursor-pointer transition-all duration-200 hover:scale-105"
            @click="$emit('select-files')"
            >点击选择</span
          >
        </p>
        <p
          class="text-xs text-muted-foreground opacity-75 transition-all duration-300"
          :class="{ 'opacity-100': isDragging }"
        >
          支持图片、文档、音频、视频等多种格式，最大 50MB
        </p>
      </div>

      <!-- Floating particles during drag -->
      <div v-if="isDragging" class="absolute inset-0 pointer-events-none">
        <div class="particle particle-1" />
        <div class="particle particle-2" />
        <div class="particle particle-3" />
      </div>
    </div>

    <!-- Enhanced Attachments Grid with Staggered Animation -->
    <div v-if="attachments.length > 0" class="attachments-grid animate-grid-appear">
      <div class="flex flex-wrap gap-3">
        <div
          v-for="(attachment, index) in attachments"
          :key="attachment.id"
          class="attachment-item relative group"
          :class="{
            'animate-attachment-enter': true,
            'animate-attachment-uploading': attachment.status === 'uploading',
            'animate-attachment-processing': attachment.status === 'processing',
            'animate-attachment-error': attachment.status === 'error'
          }"
          :style="{
            animationDelay: `${index * 80}ms`,
            '--stagger-index': index
          }"
        >
          <!-- Enhanced Image Attachment -->
          <div v-if="attachment.type === 'image'" class="image-attachment relative">
            <!-- Enhanced Loading State with Ripple Effect -->
            <div
              v-if="attachment.status === 'uploading'"
              class="upload-progress absolute inset-0 bg-black/60 rounded-lg flex flex-col items-center justify-center z-10"
            >
              <div class="relative">
                <div
                  class="w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin"
                />
                <div
                  class="absolute inset-0 w-8 h-8 border-2 border-white/30 rounded-full animate-ping"
                />
              </div>
              <span class="text-xs text-white font-medium mt-2 animate-pulse-text">上传中...</span>
              <div class="w-full max-w-[60px] h-1 bg-white/30 rounded-full mt-2 overflow-hidden">
                <div
                  class="h-full bg-gradient-to-r from-white via-blue-200 to-white transition-all duration-300 animate-progress-shine"
                  :style="{ width: `${attachment.uploadProgress || 0}%` }"
                />
              </div>
            </div>

            <!-- Enhanced AI Processing State with Morphing Animation -->
            <div
              v-if="attachment.status === 'processing'"
              class="processing-overlay absolute inset-0 bg-gradient-to-br from-primary/90 to-primary/70 rounded-lg flex flex-col items-center justify-center z-10"
            >
              <div class="processing-icon mb-2 relative">
                <Sparkles :size="20" class="text-white animate-processing-pulse" />
                <div class="absolute inset-0 animate-processing-glow">
                  <Sparkles :size="20" class="text-white/50" />
                </div>
              </div>
              <span class="text-xs text-white font-medium animate-text-shimmer">AI分析中...</span>
              <div class="mt-1 flex space-x-1">
                <div
                  class="w-1 h-1 bg-white rounded-full animate-processing-dots"
                  style="animation-delay: 0s"
                />
                <div
                  class="w-1 h-1 bg-white rounded-full animate-processing-dots"
                  style="animation-delay: 0.2s"
                />
                <div
                  class="w-1 h-1 bg-white rounded-full animate-processing-dots"
                  style="animation-delay: 0.4s"
                />
              </div>
            </div>

            <!-- Enhanced Error State with Shake Animation -->
            <div
              v-if="attachment.status === 'error'"
              class="error-overlay absolute inset-0 bg-gradient-to-br from-red-500/90 to-red-600/80 rounded-lg flex flex-col items-center justify-center z-10 animate-error-shake"
            >
              <AlertCircle :size="20" class="text-white mb-1 animate-error-icon" />
              <span class="text-xs text-white font-medium text-center px-1 animate-fade-in-up">{{
                attachment.error || '上传失败'
              }}</span>
              <button
                @click="$emit('retry', attachment.id)"
                class="mt-2 px-2 py-1 bg-white/20 text-white text-xs rounded hover:bg-white/30 transition-all duration-200 hover:scale-105 active:scale-95"
                aria-label="按钮"
              >
                重试
              </button>
            </div>

            <!-- Enhanced Image Display with Smooth Transitions -->
            <img
              :src="attachment.data"
              :alt="attachment.name"
              class="attachment-image h-24 w-24 object-cover rounded-lg border border-border transition-all duration-300 cursor-pointer"
              :class="{
                'opacity-50 scale-95':
                  attachment.status === 'uploading' || attachment.status === 'processing',
                'opacity-70 grayscale': attachment.status === 'error',
                'hover:scale-110 hover:shadow-xl hover:z-10 hover:border-primary/50':
                  attachment.status === 'ready' || !attachment.status,
                'transform-gpu': true
              }"
              @load="onImageLoad(attachment)"
              @error="onImageError(attachment)"
              @click="openImagePreview(attachment)"
            />

            <!-- Enhanced Hover Overlay with Glass Morphism -->
            <div
              class="attachment-overlay absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent rounded-lg opacity-0 group-hover:opacity-100 transition-all duration-300 backdrop-blur-sm"
            >
              <div class="absolute bottom-2 left-2 right-2 animate-slide-up">
                <div class="text-xs text-white font-medium truncate mb-1 animate-text-glow">
                  {{ attachment.name }}
                </div>
                <div class="flex items-center justify-between text-xs text-white/80">
                  <span class="animate-fade-in-delayed">{{ formatFileSize(attachment.size) }}</span>
                  <span
                    v-if="isVisionCapable(attachment)"
                    class="flex items-center gap-1 text-green-300 animate-bounce-subtle"
                  >
                    <Eye :size="10" />
                    AI可识别
                  </span>
                </div>
              </div>

              <!-- Enhanced Action Buttons with Ripple Effect -->
              <div class="absolute top-1 right-1 flex gap-1 animate-slide-down">
                <button
                  @click.stop="openImagePreview(attachment)"
                  class="action-btn p-1.5 bg-black/50 hover:bg-black/70 text-white rounded-full transition-all duration-200 hover:scale-110 active:scale-95 ripple-effect"
                  title="预览图片"
                  aria-label="按钮"
                >
                  <Maximize2 :size="12" />
                </button>
                <button
                  @click.stop="$emit('remove', attachment.id)"
                  class="action-btn p-1.5 bg-red-500/80 hover:bg-red-500 text-white rounded-full transition-all duration-200 hover:scale-110 active:scale-95 ripple-effect"
                  title="删除图片"
                  aria-label="按钮"
                >
                  <X :size="12" />
                </button>
              </div>
            </div>

            <!-- Enhanced Vision Capability Badge with Glow Effect -->
            <div
              v-if="
                isVisionCapable(attachment) && (attachment.status === 'ready' || !attachment.status)
              "
              class="vision-badge absolute top-2 left-2 px-2 py-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xs rounded-full font-medium shadow-lg flex items-center gap-1 animate-badge-appear"
            >
              <Eye :size="10" class="animate-eye-blink" />
              <span class="animate-text-shimmer">AI可识别</span>
            </div>

            <!-- Enhanced Provider Support Indicator -->
            <div
              v-if="
                !isCurrentProviderVisionCapable &&
                (attachment.status === 'ready' || !attachment.status)
              "
              class="provider-warning absolute top-2 left-2 px-2 py-1 bg-gradient-to-r from-yellow-500 to-orange-500 text-white text-xs rounded-full font-medium shadow-lg flex items-center gap-1 animate-warning-pulse"
              title="当前LLM提供商不支持图片分析"
            >
              <AlertTriangle :size="10" class="animate-triangle-wiggle" />
              <span class="animate-text-shimmer">需切换模型</span>
            </div>
          </div>

          <!-- Enhanced Video Attachment -->
          <div v-else-if="attachment.type === 'video'" class="video-attachment relative">
            <!-- Video thumbnail/preview -->
            <div
              class="video-preview h-24 w-32 bg-black rounded-lg overflow-hidden relative cursor-pointer"
              @click="openFilePreview(attachment)"
            >
              <video
                v-if="attachment.data"
                :src="attachment.data"
                class="w-full h-full object-cover"
                preload="metadata"
                muted
              />
              <div
                class="video-overlay absolute inset-0 bg-black/40 flex items-center justify-center"
              >
                <Play :size="24" class="text-white" />
              </div>
              <div
                class="duration-badge absolute bottom-1 right-1 px-1 py-0.5 bg-black/70 text-white text-xs rounded"
              >
                {{ formatDuration(attachment.duration) }}
              </div>
            </div>

            <!-- Video info -->
            <div class="video-info mt-1">
              <div class="text-xs font-medium truncate">{{ attachment.name }}</div>
              <div class="text-xs text-muted-foreground">{{ formatFileSize(attachment.size) }}</div>
            </div>

            <!-- Actions -->
            <div
              class="absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity"
            >
              <button
                @click.stop="openFilePreview(attachment)"
                class="action-btn"
                title="预览"
                aria-label="按钮"
              >
                <Play :size="12" />
              </button>
              <button
                @click.stop="downloadFile(attachment)"
                class="action-btn"
                title="下载"
                aria-label="按钮"
              >
                <Download :size="12" />
              </button>
              <button
                @click.stop="$emit('remove', attachment.id)"
                class="action-btn-danger"
                title="删除"
                aria-label="按钮"
              >
                <X :size="12" />
              </button>
            </div>
          </div>

          <!-- Enhanced Audio Attachment -->
          <div v-else-if="attachment.type === 'audio'" class="audio-attachment relative">
            <div
              class="audio-preview flex items-center gap-3 p-3 bg-muted/20 rounded-lg border border-border w-64"
            >
              <div class="audio-icon p-2 bg-green-100 dark:bg-green-900 rounded-full">
                <Music :size="20" class="text-green-600 dark:text-green-400" />
              </div>
              <div class="audio-info flex-1 min-w-0">
                <div class="text-sm font-medium truncate">{{ attachment.name }}</div>
                <div class="text-xs text-muted-foreground flex items-center gap-2">
                  <span>{{ formatFileSize(attachment.size) }}</span>
                  <span v-if="attachment.duration"
                    >• {{ formatDuration(attachment.duration) }}</span
                  >
                </div>
              </div>
              <button
                @click="openFilePreview(attachment)"
                class="play-btn p-2 bg-primary/10 hover:bg-primary/20 rounded-full transition-colors"
                aria-label="按钮"
              >
                <Play :size="16" class="text-primary" />
              </button>
            </div>

            <!-- Actions -->
            <div
              class="absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity"
            >
              <button
                @click.stop="downloadFile(attachment)"
                class="action-btn"
                title="下载"
                aria-label="按钮"
              >
                <Download :size="12" />
              </button>
              <button
                @click.stop="$emit('remove', attachment.id)"
                class="action-btn-danger"
                title="删除"
                aria-label="按钮"
              >
                <X :size="12" />
              </button>
            </div>
          </div>

          <!-- Enhanced Document Attachment -->
          <div v-else-if="attachment.type === 'document'" class="document-attachment relative">
            <div
              class="document-preview flex items-center gap-3 p-3 bg-muted/20 rounded-lg border border-border w-64"
            >
              <div class="document-icon p-2 rounded-full" :class="getDocumentIconClass(attachment)">
                <component :is="getDocumentIcon(attachment)" :size="20" />
              </div>
              <div class="document-info flex-1 min-w-0">
                <div class="text-sm font-medium truncate">{{ attachment.name }}</div>
                <div class="text-xs text-muted-foreground flex items-center gap-2">
                  <span>{{ getFileTypeLabel(attachment) }}</span>
                  <span>• {{ formatFileSize(attachment.size) }}</span>
                </div>
              </div>
              <button
                @click="openFilePreview(attachment)"
                class="preview-btn p-2 bg-blue-100 dark:bg-blue-900 hover:bg-blue-200 dark:hover:bg-blue-800 rounded-full transition-colors"
                aria-label="按钮"
              >
                <Eye :size="16" class="text-blue-600 dark:text-blue-400" />
              </button>
            </div>

            <!-- Actions -->
            <div
              class="absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity"
            >
              <button
                @click.stop="downloadFile(attachment)"
                class="action-btn"
                title="下载"
                aria-label="按钮"
              >
                <Download :size="12" />
              </button>
              <button
                @click.stop="$emit('remove', attachment.id)"
                class="action-btn-danger"
                title="删除"
                aria-label="按钮"
              >
                <X :size="12" />
              </button>
            </div>
          </div>

          <!-- Generic File Attachment (Enhanced) -->
          <div v-else class="file-attachment relative">
            <div
              class="file-preview flex items-center gap-3 p-3 bg-muted/20 rounded-lg border border-border min-w-[200px]"
            >
              <div class="file-icon p-2 bg-gray-100 dark:bg-gray-800 rounded-full">
                <component
                  :is="getGenericFileIcon(attachment)"
                  :size="20"
                  class="text-gray-600 dark:text-gray-400"
                />
              </div>
              <div class="file-info flex-1 min-w-0">
                <div class="text-sm font-medium truncate">{{ attachment.name }}</div>
                <div class="text-xs text-muted-foreground flex items-center gap-2">
                  <span>{{ getFileTypeLabel(attachment) }}</span>
                  <span v-if="attachment.size">• {{ formatFileSize(attachment.size) }}</span>
                </div>
              </div>
            </div>

            <!-- Actions -->
            <div
              class="absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity"
            >
              <button
                @click.stop="downloadFile(attachment)"
                class="action-btn"
                title="下载"
                aria-label="按钮"
              >
                <Download :size="12" />
              </button>
              <button
                @click.stop="$emit('remove', attachment.id)"
                class="action-btn-danger"
                title="删除"
                aria-label="按钮"
              >
                <X :size="12" />
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Upload Progress (if needed) -->
      <div v-if="uploadProgress.length > 0" class="upload-progress mt-2 space-y-1">
        <div
          v-for="progress in uploadProgress"
          :key="progress.id"
          class="progress-item flex items-center gap-2 text-sm"
        >
          <div class="progress-bar flex-1 h-1 bg-muted rounded-full overflow-hidden">
            <div
              class="progress-fill h-full bg-primary transition-all duration-300"
              :style="{ width: `${progress.progress}%` }"
            />
          </div>
          <span class="progress-text text-xs text-muted-foreground">{{ progress.progress }}%</span>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue'
import {
  X,
  FileText,
  File,
  ImageIcon,
  Eye,
  Maximize2,
  AlertCircle,
  Sparkles,
  AlertTriangle,
  Play,
  Music,
  Video,
  FileAudio,
  FileImage,
  Archive,
  Download
} from 'lucide-vue-next'
import { useSettingsStore } from '@renderer/src/stores/settings'

interface Attachment {
  id: string
  name: string
  type: 'image' | 'text' | 'file' | 'video' | 'audio' | 'document' | 'archive'
  data?: string
  content?: string
  size?: number
  status?: 'uploading' | 'processing' | 'ready' | 'error'
  uploadProgress?: number
  error?: string
  mimeType?: string
  duration?: number // for video/audio
  dimensions?: { width: number; height: number } // for images/video
}

interface UploadProgress {
  id: string
  progress: number
}

interface Props {
  attachments: Attachment[]
  uploadProgress?: UploadProgress[]
  showDropZone?: boolean
  currentProvider?: string
}

const props = withDefaults(defineProps<Props>(), {
  uploadProgress: () => [],
  showDropZone: false,
  currentProvider: 'openai'
})

const emit = defineEmits<{
  remove: [id: string]
  retry: [id: string]
  'select-files': []
  'image-preview': [attachment: Attachment]
  'file-preview': [attachment: Attachment]
  drop: [event: DragEvent]
}>()

// Store
const settingsStore = useSettingsStore()

// Drag and drop state
const isDragging = ref(false)
const dragCounter = ref(0)

// Vision-capable providers
const visionCapableProviders = ['openai', 'anthropic', 'google']
const visionCapableModels = {
  openai: ['gpt-4o', 'gpt-4-vision-preview', 'gpt-4-turbo'],
  anthropic: [
    'claude-3-opus-20240229',
    'claude-3-sonnet-20240229',
    'claude-3-haiku-20240307',
    'claude-3-5-sonnet-20241022'
  ],
  google: ['gemini-pro-vision', 'gemini-1.5-pro', 'gemini-1.5-flash']
}

// Computed properties
const dragDropClasses = computed(() => ({
  'border-primary bg-primary/5': isDragging.value,
  'border-muted-foreground/30 hover:border-primary/50': !isDragging.value
}))

const isCurrentProviderVisionCapable = computed(() => {
  const currentProvider = settingsStore.llmProvider
  const currentModel = settingsStore.modelName

  if (!visionCapableProviders.includes(currentProvider)) {
    return false
  }

  if (visionCapableModels[currentProvider as keyof typeof visionCapableModels]) {
    return visionCapableModels[currentProvider as keyof typeof visionCapableModels].some(
      model => currentModel.includes(model) || model.includes(currentModel)
    )
  }

  return false
})

// Format file size for display
const formatFileSize = (bytes: number = 0): string => {
  if (bytes === 0) return '0 B'

  const k = 1024
  const sizes = ['B', 'KB', 'MB', 'GB']
  const i = Math.floor(Math.log(bytes) / Math.log(k))

  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`
}

// Format duration for display (seconds to mm:ss format)
const formatDuration = (seconds: number = 0): string => {
  if (seconds === 0) return '0:00'

  const minutes = Math.floor(seconds / 60)
  const remainingSeconds = Math.floor(seconds % 60)

  return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`
}

// Get file type label
const getFileTypeLabel = (attachment: Attachment): string => {
  const extension = attachment.name.split('.').pop()?.toLowerCase() || ''

  const typeMap: Record<string, string> = {
    pdf: 'PDF',
    doc: 'Word',
    docx: 'Word',
    xls: 'Excel',
    xlsx: 'Excel',
    ppt: 'PowerPoint',
    pptx: 'PowerPoint',
    txt: '文本',
    md: 'Markdown',
    json: 'JSON',
    xml: 'XML',
    csv: 'CSV',
    zip: '压缩包',
    rar: '压缩包',
    '7z': '压缩包',
    tar: '压缩包',
    gz: '压缩包'
  }

  return typeMap[extension] || extension.toUpperCase()
}

// Get document icon based on file type
const getDocumentIcon = (attachment: Attachment) => {
  const extension = attachment.name.split('.').pop()?.toLowerCase() || ''

  if (['pdf'].includes(extension)) return FileText
  if (['doc', 'docx'].includes(extension)) return FileText
  if (['xls', 'xlsx'].includes(extension)) return FileText
  if (['ppt', 'pptx'].includes(extension)) return FileText
  if (['txt', 'md'].includes(extension)) return FileText

  return File
}

// Get document icon class
const getDocumentIconClass = (attachment: Attachment): string => {
  const extension = attachment.name.split('.').pop()?.toLowerCase() || ''

  if (extension === 'pdf') return 'bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400'
  if (['doc', 'docx'].includes(extension))
    return 'bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-400'
  if (['xls', 'xlsx'].includes(extension))
    return 'bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400'
  if (['ppt', 'pptx'].includes(extension))
    return 'bg-orange-100 dark:bg-orange-900 text-orange-600 dark:text-orange-400'
  if (['txt', 'md'].includes(extension))
    return 'bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400'

  return 'bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400'
}

// Get generic file icon
const getGenericFileIcon = (attachment: Attachment) => {
  const extension = attachment.name.split('.').pop()?.toLowerCase() || ''

  if (['zip', 'rar', '7z', 'tar', 'gz'].includes(extension)) return Archive
  if (['mp3', 'wav', 'ogg', 'm4a'].includes(extension)) return FileAudio
  if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(extension)) return FileImage
  if (['mp4', 'avi', 'mov', 'wmv'].includes(extension)) return Video

  return File
}

// Check if attachment is vision-capable
const isVisionCapable = (attachment: Attachment): boolean => {
  if (attachment.type !== 'image') return false

  const supportedFormats = ['jpeg', 'jpg', 'png', 'webp', 'gif']
  const fileExtension = attachment.name.split('.').pop()?.toLowerCase()

  return supportedFormats.includes(fileExtension || '')
}

// Drag and drop handlers
const handleDragEnter = (e: DragEvent) => {
  e.preventDefault()
  dragCounter.value++
  isDragging.value = true
}

const handleDragLeave = (e: DragEvent) => {
  e.preventDefault()
  dragCounter.value--
  if (dragCounter.value === 0) {
    isDragging.value = false
  }
}

const handleDragOver = (e: DragEvent) => {
  e.preventDefault()
}

const handleDrop = (e: DragEvent) => {
  e.preventDefault()
  isDragging.value = false
  dragCounter.value = 0
  emit('drop', e)
}

// Image event handlers
const onImageLoad = (attachment: Attachment) => {
  // Optionally update attachment status
  console.log('Image loaded:', attachment.name)
}

const onImageError = (attachment: Attachment) => {
  console.error('Failed to load image:', attachment.name)
  // Emit error event if needed
}

const openImagePreview = (attachment: Attachment) => {
  if (attachment.status === 'ready' || !attachment.status) {
    emit('image-preview', attachment)
  }
}

const openFilePreview = (attachment: Attachment) => {
  if (attachment.status === 'ready' || !attachment.status) {
    emit('file-preview', attachment)
  }
}

const downloadFile = async (attachment: Attachment) => {
  try {
    if (attachment.data) {
      const link = document.createElement('a')
      link.href = attachment.data
      link.download = attachment.name
      document.body.appendChild(link)
      link.click()
      document.body.removeChild(link)
    }
  } catch (error) {
    console.error('Failed to download file:', error)
  }
}
</script>

<style scoped>
/* 🎨 响应式设计系统 */
:root {
  --breakpoint-sm: 640px;
  --breakpoint-md: 768px;
  --breakpoint-lg: 1024px;
  --breakpoint-xl: 1280px;
  --breakpoint-2xl: 1536px;
}

/* 🎨 响应式实用类 */
.container-sm {
  max-width: var(--breakpoint-sm);
}
.container-md {
  max-width: var(--breakpoint-md);
}
.container-lg {
  max-width: var(--breakpoint-lg);
}
.container-xl {
  max-width: var(--breakpoint-xl);
}

/* 响应式显示 */
.hidden-sm {
  display: none;
}
.hidden-md {
  display: none;
}
.hidden-lg {
  display: none;
}

@media (min-width: 640px) {
  .hidden-sm {
    display: block;
  }
}

@media (min-width: 768px) {
  .hidden-md {
    display: block;
  }
}

@media (min-width: 1024px) {
  .hidden-lg {
    display: block;
  }
}

/* 响应式文本 */
.text-responsive-sm {
  font-size: clamp(0.875rem, 2vw, 1rem);
}
.text-responsive-base {
  font-size: clamp(1rem, 2.5vw, 1.125rem);
}
.text-responsive-lg {
  font-size: clamp(1.125rem, 3vw, 1.25rem);
}
.text-responsive-xl {
  font-size: clamp(1.25rem, 3.5vw, 1.5rem);
}

/* 响应式间距 */
.space-responsive-sm {
  gap: clamp(0.5rem, 2vw, 1rem);
}
.space-responsive-md {
  gap: clamp(1rem, 3vw, 1.5rem);
}
.space-responsive-lg {
  gap: clamp(1.5rem, 4vw, 2rem);
}

/* 响应式网格 */
.grid-responsive-sm {
  grid-template-columns: repeat(auto-fit, minmax(clamp(200px, 25vw, 300px), 1fr));
}

.grid-responsive-md {
  grid-template-columns: repeat(auto-fit, minmax(clamp(250px, 30vw, 350px), 1fr));
}

.grid-responsive-lg {
  grid-template-columns: repeat(auto-fit, minmax(clamp(300px, 35vw, 400px), 1fr));
}

/* 响应式布局调整 */
@media (max-width: 640px) {
  .flex-col-mobile {
    flex-direction: column;
  }
  .grid-1-mobile {
    grid-template-columns: 1fr;
  }
  .gap-2-mobile {
    gap: var(--space-2);
  }
  .p-4-mobile {
    padding: var(--space-4);
  }
}

@media (max-width: 768px) {
  .flex-col-tablet {
    flex-direction: column;
  }
  .grid-2-tablet {
    grid-template-columns: repeat(2, 1fr);
  }
  .gap-4-tablet {
    gap: var(--space-4);
  }
  .p-6-tablet {
    padding: var(--space-6);
  }
}

@media (max-width: 1024px) {
  .sidebar-layout {
    grid-template-columns: 1fr;
  }
  .sidebar {
    position: static;
  }
}

/* 🎨 现代布局系统 */
.flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

.flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.flex-start {
  display: flex;
  align-items: center;
  justify-content: flex-start;
}

.flex-end {
  display: flex;
  align-items: center;
  justify-content: flex-end;
}

.flex-col {
  display: flex;
  flex-direction: column;
}

.flex-wrap {
  display: flex;
  flex-wrap: wrap;
}

/* 🎨 网格系统 */
.grid-auto-fit {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: var(--space-4);
}

.grid-auto-fill {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: var(--space-4);
}

.grid-cols-2 {
  grid-template-columns: repeat(2, 1fr);
}
.grid-cols-3 {
  grid-template-columns: repeat(3, 1fr);
}
.grid-cols-4 {
  grid-template-columns: repeat(4, 1fr);
}

.grid-gap-2 {
  gap: var(--space-2);
}
.grid-gap-4 {
  gap: var(--space-4);
}
.grid-gap-6 {
  gap: var(--space-6);
}

/* 🎨 卡片布局 */
.card {
  background: white;
  border-radius: 12px;
  box-shadow:
    0 1px 3px rgba(0, 0, 0, 0.1),
    0 1px 2px rgba(0, 0, 0, 0.06);
  transition:
    box-shadow 0.2s ease,
    transform 0.2s ease;
}

.card:hover {
  box-shadow:
    0 4px 6px rgba(0, 0, 0, 0.1),
    0 2px 4px rgba(0, 0, 0, 0.06);
  transform: translateY(-1px);
}

.card-interactive:hover {
  cursor: pointer;
  transform: translateY(-2px);
  box-shadow:
    0 10px 25px rgba(0, 0, 0, 0.15),
    0 4px 10px rgba(0, 0, 0, 0.1);
}

/* 🎨 页面布局 */
.page-layout {
  min-height: 100vh;
  display: grid;
  grid-template-rows: auto 1fr auto;
}

.page-header {
  position: sticky;
  top: 0;
  z-index: 50;
  background: white;
  border-bottom: 1px solid var(--color-gray-200);
}

.page-main {
  padding: var(--space-6) 0;
}

.page-footer {
  border-top: 1px solid var(--color-gray-200);
  background: var(--color-gray-50);
}

/* 🎨 侧边栏布局 */
.sidebar-layout {
  display: grid;
  grid-template-columns: 280px 1fr;
  gap: var(--space-6);
}

.sidebar {
  position: sticky;
  top: var(--space-6);
  height: fit-content;
}

.sidebar-content {
  padding: var(--space-6);
  background: white;
  border-radius: 12px;
  border: 1px solid var(--color-gray-200);
}

/* 🎨 响应式工具 */
@media (max-width: 768px) {
  .sidebar-layout {
    grid-template-columns: 1fr;
    gap: var(--space-4);
  }

  .hidden-mobile {
    display: none;
  }
  .flex-mobile-col {
    flex-direction: column;
  }
  .grid-mobile-1 {
    grid-template-columns: 1fr;
  }
}

/* 🎨 完整间距系统 - 基于4px网格 */
:root {
  --space-0: 0;
  --space-1: 0.25rem; /* 4px */
  --space-2: 0.5rem; /* 8px */
  --space-3: 0.75rem; /* 12px */
  --space-4: 1rem; /* 16px */
  --space-5: 1.25rem; /* 20px */
  --space-6: 1.5rem; /* 24px */
  --space-8: 2rem; /* 32px */
  --space-10: 2.5rem; /* 40px */
  --space-12: 3rem; /* 48px */
  --space-16: 4rem; /* 64px */
  --space-20: 5rem; /* 80px */
  --space-24: 6rem; /* 96px */
  --space-32: 8rem; /* 128px */

  /* 负间距 */
  --space-neg-1: -0.25rem;
  --space-neg-2: -0.5rem;
  --space-neg-4: -1rem;
}

/* 🎨 间距实用类 */
.m-1 {
  margin: var(--space-1);
}
.m-2 {
  margin: var(--space-2);
}
.m-3 {
  margin: var(--space-3);
}
.m-4 {
  margin: var(--space-4);
}
.m-6 {
  margin: var(--space-6);
}
.m-8 {
  margin: var(--space-8);
}

.p-1 {
  padding: var(--space-1);
}
.p-2 {
  padding: var(--space-2);
}
.p-3 {
  padding: var(--space-3);
}
.p-4 {
  padding: var(--space-4);
}
.p-6 {
  padding: var(--space-6);
}
.p-8 {
  padding: var(--space-8);
}

.mx-auto {
  margin-left: auto;
  margin-right: auto;
}
.my-auto {
  margin-top: auto;
  margin-bottom: auto;
}

.px-1 {
  padding-left: var(--space-1);
  padding-right: var(--space-1);
}
.px-2 {
  padding-left: var(--space-2);
  padding-right: var(--space-2);
}
.px-3 {
  padding-left: var(--space-3);
  padding-right: var(--space-3);
}
.px-4 {
  padding-left: var(--space-4);
  padding-right: var(--space-4);
}
.px-6 {
  padding-left: var(--space-6);
  padding-right: var(--space-6);
}

.py-1 {
  padding-top: var(--space-1);
  padding-bottom: var(--space-1);
}
.py-2 {
  padding-top: var(--space-2);
  padding-bottom: var(--space-2);
}
.py-3 {
  padding-top: var(--space-3);
  padding-bottom: var(--space-3);
}
.py-4 {
  padding-top: var(--space-4);
  padding-bottom: var(--space-4);
}
.py-6 {
  padding-top: var(--space-6);
  padding-bottom: var(--space-6);
}

/* 🎨 容器和布局间距 */
.container {
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding-left: var(--space-4);
  padding-right: var(--space-4);
}

.section-spacing {
  padding-top: var(--space-12);
  padding-bottom: var(--space-12);
}

.card-spacing {
  padding: var(--space-6);
}

.stack-sm > * + * {
  margin-top: var(--space-2);
}
.stack-md > * + * {
  margin-top: var(--space-4);
}
.stack-lg > * + * {
  margin-top: var(--space-6);
}
.stack-xl > * + * {
  margin-top: var(--space-8);
}

.inline-sm > * + * {
  margin-left: var(--space-2);
}
.inline-md > * + * {
  margin-left: var(--space-4);
}
.inline-lg > * + * {
  margin-left: var(--space-6);
}

/* 🎨 完整字体系统 */
:root {
  /* 字体族 */
  --font-family-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-family-mono: 'JetBrains Mono', 'Fira Code', 'Source Code Pro', monospace;

  /* 字体大小 - 基于1.25的倍数比例 */
  --font-size-xs: 0.75rem; /* 12px */
  --font-size-sm: 0.875rem; /* 14px */
  --font-size-base: 1rem; /* 16px */
  --font-size-lg: 1.125rem; /* 18px */
  --font-size-xl: 1.25rem; /* 20px */
  --font-size-2xl: 1.5rem; /* 24px */
  --font-size-3xl: 1.875rem; /* 30px */
  --font-size-4xl: 2.25rem; /* 36px */
  --font-size-5xl: 3rem; /* 48px */

  /* 字体权重 */
  --font-weight-thin: 100;
  --font-weight-light: 300;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 600;
  --font-weight-bold: 700;
  --font-weight-extrabold: 800;

  /* 行高 */
  --line-height-tight: 1.25;
  --line-height-snug: 1.375;
  --line-height-normal: 1.5;
  --line-height-relaxed: 1.625;
  --line-height-loose: 2;

  /* 字母间距 */
  --letter-spacing-tighter: -0.05em;
  --letter-spacing-tight: -0.025em;
  --letter-spacing-normal: 0;
  --letter-spacing-wide: 0.025em;
  --letter-spacing-wider: 0.05em;
  --letter-spacing-widest: 0.1em;
}

/* 🎨 字体实用类 */
.font-sans {
  font-family: var(--font-family-sans);
}
.font-mono {
  font-family: var(--font-family-mono);
}

.text-xs {
  font-size: var(--font-size-xs);
  line-height: var(--line-height-tight);
}
.text-sm {
  font-size: var(--font-size-sm);
  line-height: var(--line-height-snug);
}
.text-base {
  font-size: var(--font-size-base);
  line-height: var(--line-height-normal);
}
.text-lg {
  font-size: var(--font-size-lg);
  line-height: var(--line-height-relaxed);
}
.text-xl {
  font-size: var(--font-size-xl);
  line-height: var(--line-height-relaxed);
}
.text-2xl {
  font-size: var(--font-size-2xl);
  line-height: var(--line-height-loose);
}
.text-3xl {
  font-size: var(--font-size-3xl);
  line-height: var(--line-height-loose);
}

.font-thin {
  font-weight: var(--font-weight-thin);
}
.font-light {
  font-weight: var(--font-weight-light);
}
.font-normal {
  font-weight: var(--font-weight-normal);
}
.font-medium {
  font-weight: var(--font-weight-medium);
}
.font-semibold {
  font-weight: var(--font-weight-semibold);
}
.font-bold {
  font-weight: var(--font-weight-bold);
}

.leading-tight {
  line-height: var(--line-height-tight);
}
.leading-snug {
  line-height: var(--line-height-snug);
}
.leading-normal {
  line-height: var(--line-height-normal);
}
.leading-relaxed {
  line-height: var(--line-height-relaxed);
}

.tracking-tight {
  letter-spacing: var(--letter-spacing-tight);
}
.tracking-normal {
  letter-spacing: var(--letter-spacing-normal);
}
.tracking-wide {
  letter-spacing: var(--letter-spacing-wide);
}

/* 🎨 文本层次优化 */
.heading-1 {
  font-size: var(--font-size-4xl);
  font-weight: var(--font-weight-bold);
  line-height: var(--line-height-tight);
  letter-spacing: var(--letter-spacing-tighter);
  margin-bottom: 1rem;
}

.heading-2 {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-tight);
  letter-spacing: var(--letter-spacing-tighter);
  margin-bottom: 0.875rem;
}

.heading-3 {
  font-size: var(--font-size-2xl);
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-snug);
  letter-spacing: var(--letter-spacing-tight);
  margin-bottom: 0.75rem;
}

.body-large {
  font-size: var(--font-size-lg);
  line-height: var(--line-height-relaxed);
  letter-spacing: var(--letter-spacing-normal);
}

.body-regular {
  font-size: var(--font-size-base);
  line-height: var(--line-height-normal);
  letter-spacing: var(--letter-spacing-normal);
}

.body-small {
  font-size: var(--font-size-sm);
  line-height: var(--line-height-normal);
  letter-spacing: var(--letter-spacing-wide);
}

.caption {
  font-size: var(--font-size-xs);
  line-height: var(--line-height-snug);
  letter-spacing: var(--letter-spacing-wide);
  color: var(--color-gray-600);
}

/* 🎨 高级色彩系统 */
:root {
  /* 基础色彩 */
  --color-primary: hsl(221 83% 53%);
  --color-primary-hover: hsl(221 83% 48%);
  --color-primary-active: hsl(221 83% 43%);

  /* 语义色彩 */
  --color-success: hsl(142 71% 45%);
  --color-warning: hsl(38 92% 50%);
  --color-error: hsl(0 84% 60%);
  --color-info: hsl(217 91% 60%);

  /* 中性色彩 */
  --color-gray-50: hsl(210 20% 98%);
  --color-gray-100: hsl(210 15% 95%);
  --color-gray-200: hsl(210 10% 89%);
  --color-gray-300: hsl(210 8% 75%);
  --color-gray-400: hsl(210 8% 56%);
  --color-gray-500: hsl(210 6% 43%);
  --color-gray-600: hsl(210 8% 35%);
  --color-gray-700: hsl(210 10% 28%);
  --color-gray-800: hsl(210 12% 21%);
  --color-gray-900: hsl(210 15% 15%);

  /* 透明度变体 */
  --color-primary-10: hsl(221 83% 53% / 0.1);
  --color-primary-20: hsl(221 83% 53% / 0.2);
  --color-primary-30: hsl(221 83% 53% / 0.3);
  --color-success-10: hsl(142 71% 45% / 0.1);
  --color-error-10: hsl(0 84% 60% / 0.1);
}

/* 🎨 色彩实用类 */
.text-primary {
  color: var(--color-primary);
}
.text-success {
  color: var(--color-success);
}
.text-warning {
  color: var(--color-warning);
}
.text-error {
  color: var(--color-error);
}
.text-gray-500 {
  color: var(--color-gray-500);
}
.text-gray-600 {
  color: var(--color-gray-600);
}
.text-gray-700 {
  color: var(--color-gray-700);
}

.bg-primary {
  background-color: var(--color-primary);
}
.bg-primary-hover:hover {
  background-color: var(--color-primary-hover);
}
.bg-success {
  background-color: var(--color-success);
}
.bg-warning {
  background-color: var(--color-warning);
}
.bg-error {
  background-color: var(--color-error);
}

.border-primary {
  border-color: var(--color-primary);
}
.border-success {
  border-color: var(--color-success);
}
.border-error {
  border-color: var(--color-error);
}

/* 🎨 对比度增强 */
.high-contrast {
  --color-primary: hsl(221 100% 40%);
  --color-gray-900: hsl(210 20% 10%);
  --color-gray-100: hsl(210 15% 95%);
}

/* 🎨 暗色主题支持 */
@media (prefers-color-scheme: dark) {
  :root {
    --color-gray-50: hsl(210 15% 15%);
    --color-gray-100: hsl(210 12% 21%);
    --color-gray-200: hsl(210 10% 28%);
    --color-gray-300: hsl(210 8% 35%);
    --color-gray-400: hsl(210 6% 43%);
    --color-gray-500: hsl(210 8% 56%);
    --color-gray-600: hsl(210 8% 75%);
    --color-gray-700: hsl(210 10% 89%);
    --color-gray-800: hsl(210 15% 95%);
    --color-gray-900: hsl(210 20% 98%);
  }
}
/* Enhanced drag and drop zone with morphing animation */
.drag-drop-zone {
  background: linear-gradient(135deg, rgba(var(--background), 0.8), rgba(var(--muted), 0.2));
  backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
}

.drag-drop-zone::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    45deg,
    transparent 25%,
    rgba(var(--primary-rgb), 0.1) 25%,
    rgba(var(--primary-rgb), 0.1) 50%,
    transparent 50%,
    transparent 75%,
    rgba(var(--primary-rgb), 0.1) 75%
  );
  background-size: 20px 20px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.drag-drop-zone.border-primary {
  animation: dragPulse 2s ease-in-out infinite;
  border-color: rgb(var(--primary-rgb));
  background: linear-gradient(
    135deg,
    rgba(var(--primary-rgb), 0.1),
    rgba(var(--primary-rgb), 0.05)
  );
}

.drag-drop-zone.border-primary::before {
  opacity: 1;
  animation: backgroundMove 3s linear infinite;
}

@keyframes dragPulse {
  0%,
  100% {
    box-shadow:
      0 0 0 0 rgba(var(--primary-rgb), 0.4),
      inset 0 0 0 0 rgba(var(--primary-rgb), 0.1);
    transform: scale(1);
  }
  50% {
    box-shadow:
      0 0 0 10px rgba(var(--primary-rgb), 0.1),
      inset 0 0 20px rgba(var(--primary-rgb), 0.2);
    transform: scale(1.02);
  }
}

@keyframes backgroundMove {
  0% {
    background-position: 0 0;
  }
  100% {
    background-position: 20px 20px;
  }
}

/* Floating particles for drag state */
.particle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: rgba(var(--primary-rgb), 0.6);
  border-radius: 50%;
  pointer-events: none;
}

.particle-1 {
  top: 20%;
  left: 20%;
  animation: float1 3s ease-in-out infinite;
}

.particle-2 {
  top: 60%;
  right: 30%;
  animation: float2 4s ease-in-out infinite;
}

.particle-3 {
  bottom: 30%;
  left: 70%;
  animation: float3 3.5s ease-in-out infinite;
}

@keyframes float1 {
  0%,
  100% {
    transform: translateY(0) scale(1);
    opacity: 0.6;
  }
  50% {
    transform: translateY(-20px) scale(1.5);
    opacity: 1;
  }
}

@keyframes float2 {
  0%,
  100% {
    transform: translateX(0) scale(0.8);
    opacity: 0.4;
  }
  50% {
    transform: translateX(15px) scale(1.2);
    opacity: 0.8;
  }
}

@keyframes float3 {
  0%,
  100% {
    transform: translate(0, 0) scale(1);
    opacity: 0.5;
  }
  50% {
    transform: translate(-10px, -15px) scale(1.3);
    opacity: 0.9;
  }
}

@keyframes bounceGentle {
  0%,
  100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-8px);
  }
}

/* Enhanced attachment animations with staggered entrance */
.attachments-preview {
  animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.attachments-grid {
  animation: gridAppear 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-15px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

@keyframes gridAppear {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.attachment-item {
  transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  will-change: transform;
}

@keyframes attachmentEnter {
  0% {
    opacity: 0;
    transform: translateY(30px) scale(0.8) rotateX(20deg);
    filter: blur(2px);
  }
  60% {
    opacity: 0.8;
    transform: translateY(-5px) scale(1.05) rotateX(0deg);
    filter: blur(0.5px);
  }
  100% {
    opacity: 1;
    transform: translateY(0) scale(1) rotateX(0deg);
    filter: blur(0);
  }
}

.animate-attachment-enter {
  animation: attachmentEnter 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

.animate-attachment-uploading {
  animation: uploadingPulse 2s ease-in-out infinite;
}

.animate-attachment-processing {
  animation: processingGlow 2s ease-in-out infinite;
}

.animate-attachment-error {
  animation: errorShake 0.6s ease-in-out;
}

@keyframes uploadingPulse {
  0%,
  100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.3);
  }
  50% {
    transform: scale(1.02);
    box-shadow: 0 0 0 8px rgba(59, 130, 246, 0.1);
  }
}

@keyframes processingGlow {
  0%,
  100% {
    transform: scale(1);
    box-shadow: 0 0 0 0 rgba(var(--primary-rgb), 0.4);
  }
  50% {
    transform: scale(1.03);
    box-shadow: 0 0 0 12px rgba(var(--primary-rgb), 0.1);
  }
}

@keyframes errorShake {
  0%,
  100% {
    transform: translateX(0);
  }
  25% {
    transform: translateX(-4px) rotate(-1deg);
  }
  75% {
    transform: translateX(4px) rotate(1deg);
  }
}

/* Enhanced image interactions with hover lift */
.attachment-image {
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  transform-origin: center;
  will-change: transform;
}

.attachment-image:hover {
  z-index: 10;
  position: relative;
}

.transform-gpu {
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Enhanced overlay animations */
.attachment-overlay {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.animate-slide-up {
  animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-slide-down {
  animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-text-glow {
  animation: textGlow 1.5s ease-in-out infinite alternate;
}

@keyframes textGlow {
  from {
    text-shadow: 0 0 2px rgba(255, 255, 255, 0.3);
  }
  to {
    text-shadow:
      0 0 6px rgba(255, 255, 255, 0.6),
      0 0 12px rgba(255, 255, 255, 0.3);
  }
}

.animate-fade-in-delayed {
  animation: fadeInDelayed 0.4s ease-out 0.1s both;
}

@keyframes fadeInDelayed {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.animate-bounce-subtle {
  animation: bounceSubtle 2s ease-in-out infinite;
}

@keyframes bounceSubtle {
  0%,
  100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-2px);
  }
}

/* Video preview styles */
.video-preview {
  transition: all 0.3s ease;
}

.video-preview:hover {
  transform: scale(1.02);
}

.video-overlay {
  transition: all 0.3s ease;
}

.video-preview:hover .video-overlay {
  background: rgba(0, 0, 0, 0.6);
}

.duration-badge {
  font-feature-settings: 'tnum';
  backdrop-filter: blur(4px);
}

/* Audio preview styles */
.audio-preview {
  transition: all 0.3s ease;
}

.audio-preview:hover {
  border-color: rgba(var(--primary), 0.3);
}

.play-btn {
  transition: all 0.2s ease;
}

.play-btn:hover {
  transform: scale(1.1);
}

/* Document preview styles */
.document-preview {
  transition: all 0.3s ease;
}

.document-preview:hover {
  border-color: rgba(var(--primary), 0.3);
  background: rgba(var(--accent), 0.8);
}

.preview-btn {
  transition: all 0.2s ease;
}

.preview-btn:hover {
  transform: scale(1.1);
}

/* Enhanced action buttons with ripple effect */
.action-btn {
  transition: all 0.2s ease;
  backdrop-filter: blur(8px);
  position: relative;
  overflow: hidden;
}

.action-btn:hover {
  transform: scale(1.1);
}

.action-btn:active {
  transform: scale(0.95);
}

.ripple-effect {
  position: relative;
  overflow: hidden;
}

.ripple-effect::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: translate(-50%, -50%);
  transition:
    width 0.3s ease,
    height 0.3s ease;
}

.ripple-effect:active::before {
  width: 40px;
  height: 40px;
}

/* Enhanced video, audio, and document styles */
.video-attachment,
.audio-attachment,
.document-attachment {
  position: relative;
  border-radius: 12px;
  overflow: hidden;
  background: rgba(var(--muted), 0.1);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.video-attachment:hover,
.audio-attachment:hover,
.document-attachment:hover {
  transform: translateY(-4px) scale(1.02);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
}

/* Enhanced upload and processing states */
.upload-progress,
.processing-overlay,
.error-overlay {
  backdrop-filter: blur(8px);
  border-radius: inherit;
}

.animate-progress-shine {
  background-size: 200% 100%;
  animation: progressShine 2s linear infinite;
}

@keyframes progressShine {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

.animate-pulse-text {
  animation: pulseText 1.5s ease-in-out infinite;
}

@keyframes pulseText {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
}

.animate-processing-pulse {
  animation: processingPulse 1.5s ease-in-out infinite;
}

@keyframes processingPulse {
  0%,
  100% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
  }
  50% {
    transform: scale(1.1) rotate(180deg);
    opacity: 0.8;
  }
}

.animate-processing-glow {
  animation: processingGlow 2s ease-in-out infinite;
}

@keyframes processingGlow {
  0%,
  100% {
    opacity: 0;
    transform: scale(0.8);
  }
  50% {
    opacity: 0.6;
    transform: scale(1.2);
  }
}

.animate-processing-dots {
  animation: processingDots 1.5s ease-in-out infinite;
}

@keyframes processingDots {
  0%,
  80%,
  100% {
    opacity: 0.3;
    transform: scale(0.8) translateY(0);
  }
  40% {
    opacity: 1;
    transform: scale(1.2) translateY(-3px);
  }
}

.animate-text-shimmer {
  background: linear-gradient(
    90deg,
    currentColor 0%,
    rgba(255, 255, 255, 0.8) 50%,
    currentColor 100%
  );
  background-size: 200% 100%;
  background-clip: text;
  -webkit-background-clip: text;
  animation: textShimmer 2s ease-in-out infinite;
}

@keyframes textShimmer {
  0%,
  100% {
    background-position: -200% 0;
  }
  50% {
    background-position: 200% 0;
  }
}

.animate-error-icon {
  animation: errorIcon 0.5s ease-in-out;
}

@keyframes errorIcon {
  0%,
  100% {
    transform: scale(1) rotate(0deg);
  }
  25% {
    transform: scale(1.2) rotate(-10deg);
  }
  75% {
    transform: scale(1.2) rotate(10deg);
  }
}

.animate-fade-in-up {
  animation: fadeInUp 0.4s ease-out;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Enhanced badge animations */
.animate-badge-appear {
  animation: badgeAppear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes badgeAppear {
  0% {
    opacity: 0;
    transform: translateX(-20px) scale(0.8);
  }
  60% {
    opacity: 0.8;
    transform: translateX(2px) scale(1.1);
  }
  100% {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
}

.animate-eye-blink {
  animation: eyeBlink 3s ease-in-out infinite;
}

@keyframes eyeBlink {
  0%,
  90%,
  100% {
    transform: scaleY(1);
  }
  95% {
    transform: scaleY(0.1);
  }
}

.animate-warning-pulse {
  animation: warningPulse 2s ease-in-out infinite;
}

@keyframes warningPulse {
  0%,
  100% {
    box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.4);
  }
  50% {
    box-shadow: 0 0 0 8px rgba(255, 193, 7, 0.1);
  }
}

.animate-triangle-wiggle {
  animation: triangleWiggle 2s ease-in-out infinite;
}

@keyframes triangleWiggle {
  0%,
  100% {
    transform: rotate(0deg);
  }
  25% {
    transform: rotate(-5deg);
  }
  75% {
    transform: rotate(5deg);
  }
}

/* Action buttons */
.action-btn {
  transition: all 0.2s ease;
  backdrop-filter: blur(8px);
}

.action-btn:hover {
  transform: scale(1.1);
}

.action-btn:active {
  transform: scale(0.95);
}

/* File attachment styles */
.file-attachment {
  min-width: 200px;
  transition: all 0.2s ease;
}

.file-attachment:hover {
  background: var(--accent);
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Remove button styles */
.remove-btn {
  transition: all 0.2s ease;
}

.remove-btn:hover {
  transform: scale(1.1);
}

/* Progress bar animation */
.progress-fill {
  background: linear-gradient(90deg, var(--primary), var(--primary-light));
}

/* Drag and drop styles (for future enhancement) */
.attachment-item.dragging {
  opacity: 0.5;
  transform: rotate(5deg);
}

/* Loading state */
.attachment-item.loading::after {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: inherit;
}

.attachment-item.loading::after {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='%23666' d='M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z' opacity='.25'/%3E%3Cpath fill='%23666' d='M12,4a8,8,0,0,1,7.89,6.7A1.53,1.53,0,0,0,21.38,12h0a1.5,1.5,0,0,0,1.48-1.75,11,11,0,0,0-21.72,0A1.5,1.5,0,0,0,2.62,12h0a1.53,1.53,0,0,0,1.49-1.3A8,8,0,0,1,12,4Z'%3E%3CanimateTransform attributeName='transform' dur='0.75s' repeatCount='indefinite' type='rotate' values='0 12 12;360 12 12'/%3E%3C/path%3E%3C/svg%3E");
  background-size: 24px 24px;
  background-repeat: no-repeat;
  background-position: center;
}

/* Responsive design */
@media (max-width: 640px) {
  .file-attachment {
    min-width: auto;
    flex: 1;
  }

  .attachments-preview .flex {
    flex-direction: column;
  }

  .image-attachment {
    align-self: flex-start;
  }
}

/* Theme variables */
:root {
  --border: hsl(214, 32%, 91%);
  --muted: hsl(210, 20%, 96%);
  --muted-foreground: hsl(215, 20%, 45%);
  --background: hsl(0, 0%, 100%);
  --foreground: hsl(222, 47%, 11%);
  --accent: hsl(210, 20%, 98%);
  --primary: hsl(221, 83%, 53%);
  --primary-light: hsl(221, 83%, 63%);
}

:root[data-theme='dark'] {
  --border: hsl(215, 20%, 25%);
  --muted: hsl(217, 33%, 17%);
  --muted-foreground: hsl(215, 20%, 65%);
  --background: hsl(222, 47%, 11%);
  --foreground: hsl(210, 20%, 98%);
  --accent: hsl(217, 33%, 15%);
  --primary: hsl(221, 83%, 65%);
  --primary-light: hsl(221, 83%, 75%);
}

/* 无障碍支持 */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* 焦点样式 */
:focus-visible {
  outline: 2px solid hsl(var(--ring, 59 130 230));
  outline-offset: 2px;
}

/* 🎨 错误状态设计 */
.error-state {
  padding: 1rem;
  border: 1px solid hsl(0 84% 60% / 0.2);
  border-radius: 8px;
  background-color: hsl(0 84% 60% / 0.05);
  color: hsl(0 84% 60%);
}

.error-icon {
  display: inline-block;
  width: 1rem;
  height: 1rem;
  margin-right: 0.5rem;
  color: hsl(0 84% 60%);
}

.error-title {
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.error-message {
  font-size: 0.875rem;
  line-height: 1.4;
  margin-bottom: 1rem;
}

.error-actions {
  display: flex;
  gap: 0.5rem;
}

.error-retry-btn {
  padding: 0.5rem 1rem;
  background-color: hsl(0 84% 60%);
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 0.875rem;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.error-retry-btn:hover {
  background-color: hsl(0 84% 60% / 0.9);
}
</style>
