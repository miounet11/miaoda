# 自定义Provider配置 - 用户体验设计方案

## 概述
本方案旨在为MiaoDa Chat设计一个直观、友好的自定义LLM Provider配置界面，让用户能够轻松添加和管理自定义AI模型提供商。

## 用户场景分析

### 主要用户群体
1. **技术用户**: 希望集成私有部署的模型或使用特定API端点
2. **企业用户**: 需要配置企业内部的AI服务
3. **开发者**: 测试不同模型或API配置
4. **隐私意识用户**: 希望使用本地部署的模型服务

### 核心用例
1. 添加新的自定义Provider
2. 编辑现有Provider配置
3. 测试Provider连接
4. 导入/导出配置
5. 管理多个Provider

## 界面设计方案

### 1. Provider管理主界面优化

#### 当前问题
- 只显示预定义的4个Provider选项
- 无法添加新的Provider
- Provider信息展示有限

#### 设计改进
```
┌─────────────────────────────────────────────────────────┐
│ LLM Provider Configuration                              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ [Choose Provider]                                       │
│                                                         │
│ Built-in Providers:                                     │
│ ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐                   │
│ │ 🤖  │  │ 🧠  │  │ 🔍  │  │ 🦙  │                   │
│ │OpenAI│  │Claude│ │Google│ │Ollama│                  │
│ └─────┘  └─────┘  └─────┘  └─────┘                   │
│                                                         │
│ Custom Providers:                                       │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ + Add Custom Provider                               │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 🏢 Internal API Server                              │ │
│ │ https://api.internal.company.com/v1                 │ │
│ │ [Edit] [Test] [Delete]                              │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 2. 自定义Provider添加向导

#### 设计原则
- **分步引导**: 将复杂配置分解为简单步骤
- **智能默认值**: 提供常见配置的模板
- **实时验证**: 在用户输入时进行格式检查
- **视觉反馈**: 清晰的进度指示和状态反馈

#### 步骤1: Provider基本信息
```
┌─────────────────────────────────────────────────────────┐
│ Add Custom Provider - Step 1 of 3                      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ Provider Information                                    │
│                                                         │
│ Provider Name *                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ My Custom AI Service                                │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Description (Optional)                                  │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Internal company AI service for secure processing  │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Icon Emoji (Optional)                                   │
│ ┌─────┐                                                 │
│ │ 🏢  │ [Choose Emoji]                                 │
│ └─────┘                                                 │
│                                                         │
│              [Cancel]  [Next: API Configuration] →     │
└─────────────────────────────────────────────────────────┘
```

#### 步骤2: API配置
```
┌─────────────────────────────────────────────────────────┐
│ Add Custom Provider - Step 2 of 3                      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ API Configuration                                       │
│                                                         │
│ API Type                                                │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ○ OpenAI Compatible    ● Custom REST API            │ │
│ │ ○ Anthropic Compatible ○ GraphQL API               │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Base URL *                                              │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ https://api.company.com/v1                         │ │
│ └─────────────────────────────────────────────────────┘ │
│ ℹ️ For OpenAI-compatible APIs, use the base URL without │
│   /chat/completions endpoint                            │
│                                                         │
│ Authentication                                          │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ● API Key    ○ Bearer Token    ○ Custom Headers     │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ API Key *                                               │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ••••••••••••••••••••••••••••••••••••••••••••••••    │[👁] │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│        ← [Back]  [Cancel]  [Next: Test Connection] →   │
└─────────────────────────────────────────────────────────┘
```

#### 步骤3: 连接测试与完成
```
┌─────────────────────────────────────────────────────────┐
│ Add Custom Provider - Step 3 of 3                      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ Connection Test & Model Configuration                   │
│                                                         │
│ Test Connection                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ [Test Connection]                    Status: Ready   │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ ✅ Connection successful!                           │ │
│ │                                                     │ │
│ │ Available Models:                                   │ │
│ │ • gpt-4-custom                                      │ │
│ │ • gpt-3.5-turbo-custom                             │ │
│ │ • claude-3-custom                                   │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Default Model *                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ gpt-4-custom                        [▼]            │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Advanced Configuration                                  │
│ ☐ Enable streaming responses                            │
│ ☐ Enable tool/function calling                         │
│ ☐ Custom request/response format                       │
│                                                         │
│               ← [Back]  [Cancel]  [Add Provider] →     │
└─────────────────────────────────────────────────────────┘
```

### 3. Provider管理界面改进

#### 现有Provider编辑
```
┌─────────────────────────────────────────────────────────┐
│ Edit Provider: Internal API Server                     │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 🏢 Internal API Server                              │ │
│ │ https://api.internal.company.com/v1                 │ │
│ │                                                     │ │
│ │ Status: ✅ Connected (Last tested: 2 minutes ago)   │ │
│ │ Model: gpt-4-custom                                 │ │
│ │ Features: Streaming ✓, Tools ✓                     │ │
│ │                                                     │ │
│ │ [Edit Configuration] [Test Connection] [Export]     │ │
│ │ [Duplicate] [Delete]                                │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                         │
│ Usage Statistics (Last 30 days):                       │
│ • Messages sent: 1,247                                 │
│ • Average response time: 1.2s                          │
│ • Success rate: 98.5%                                  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

## 交互流程设计

### 1. 添加Provider的完整流程
```
用户点击"Add Custom Provider" 
    ↓
进入向导 Step 1 (基本信息)
    ↓
输入Provider名称和描述
    ↓
进入向导 Step 2 (API配置)
    ↓
选择API类型并配置连接参数
    ↓
进入向导 Step 3 (测试连接)
    ↓
测试连接并选择默认模型
    ↓
Provider添加成功，返回设置页面
```

### 2. 错误处理流程
```
连接测试失败
    ↓
显示具体错误信息
    ↓
提供解决建议
    ↓
允许用户修改配置重新测试
    ↓
提供"Skip Test"选项继续添加
```

### 3. 导入/导出流程
```
导出配置:
用户选择Provider → 点击Export → 生成JSON配置文件 → 下载

导入配置:
用户点击"Import Provider" → 选择JSON文件 → 验证配置 → 预览设置 → 确认导入
```

## 用户反馈和状态指示

### 1. 连接状态指示
- ✅ **成功**: 绿色图标，显示响应时间
- ⚠️ **警告**: 黄色图标，连接慢或不稳定
- ❌ **失败**: 红色图标，显示错误原因
- 🔄 **测试中**: 动画加载图标

### 2. 操作反馈
- **保存成功**: Toast提示 + 成功动画
- **删除确认**: 模态对话框，显示影响范围
- **配置更改**: 实时验证 + 保存提醒

### 3. 帮助和指导
- **工具提示**: 鼠标悬停显示详细说明
- **示例配置**: 提供常见Provider的配置模板
- **文档链接**: 链接到详细的配置文档

## 响应式设计考虑

### 移动端适配
- 向导步骤在小屏幕上垂直排列
- 触摸友好的按钮尺寸
- 简化的信息展示

### 桌面端优化
- 并排显示多个配置选项
- 键盘快捷键支持
- 批量操作功能

## 无障碍性设计

### 键盘导航
- Tab键可到达所有交互元素
- Enter键确认操作
- Escape键取消操作

### 屏幕阅读器支持
- 所有表单字段有明确的标签
- 状态变更有文本提示
- 错误消息可被读取

### 视觉设计
- 足够的颜色对比度
- 不仅依赖颜色传达信息
- 支持高对比度模式

## 实现优先级

### 第一阶段 (核心功能)
1. 基本的自定义Provider添加界面
2. OpenAI兼容API的支持
3. 连接测试功能
4. Provider管理和删除

### 第二阶段 (增强功能)  
1. 配置向导界面
2. 导入/导出功能
3. 使用统计显示
4. 批量操作

### 第三阶段 (高级功能)
1. 自定义API格式支持
2. 高级配置选项
3. Provider性能监控
4. 配置模板市场

---

*此设计方案将根据用户反馈和测试结果持续迭代优化*