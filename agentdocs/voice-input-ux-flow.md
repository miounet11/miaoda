# MiaoDa Chat 语音输入交互流程

## 主要交互流程

### 1. 激活语音输入
```mermaid
graph TD
    A[用户点击麦克风按钮] --> B{检查权限}
    B -->|有权限| C[开始录音]
    B -->|无权限| D[显示权限请求提示]
    D --> E[用户授权]
    E --> C
    C --> F[显示录音界面]
    F --> G[实时显示波形]
    G --> H[实时语音转文字]
```

### 2. 录音过程
```mermaid
graph TD
    A[录音中] --> B[显示录音时长]
    A --> C[显示音量指示器]
    A --> D[实时语音识别]
    D --> E[显示临时文本]
    E --> F{置信度检查}
    F -->|高置信度| G[自动填充到输入框]
    F -->|低置信度| H[显示为灰色待确认文本]
```

### 3. 结束录音
```mermaid
graph TD
    A[用户再次点击麦克风/停止按钮] --> B[停止录音]
    B --> C[最终识别结果]
    C --> D[填充到输入框]
    D --> E[自动聚焦输入框]
    E --> F[用户可编辑文本]
```

## 状态转换

### 麦克风按钮状态
1. **默认状态**: 灰色麦克风图标
2. **悬停状态**: primary色高亮
3. **录音状态**: 红色背景 + 脉冲动画
4. **禁用状态**: 半透明 + 禁用光标

### 录音界面状态
1. **展开动画**: slideDown 0.3s ease-out
2. **录音中**: 显示波形 + 计时器
3. **收起动画**: slideUp 0.3s ease-out

## 错误处理流程
```mermaid
graph TD
    A[错误发生] --> B{错误类型}
    B -->|权限被拒绝| C[显示权限引导]
    B -->|网络错误| D[显示重试按钮]
    B -->|不支持| E[隐藏语音功能]
    C --> F[引导用户到设置]
    D --> G[用户重试]
```

## 快捷键支持
- **Ctrl/Cmd + Shift + M**: 切换语音输入
- **Esc**: 取消当前录音
- **Enter**: 确认语音输入结果